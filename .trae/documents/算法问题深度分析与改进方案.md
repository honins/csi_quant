# 算法分析与改进计划

## 1. 核心问题分析

### 1.1 高召回率与低精确率的失衡
*   **现象**：所有回测区间的Recall均接近100%，但Precision波动较大（57%~81%）。
*   **原因**：
    *   **标签定义宽松**：可能将所有短期小反弹都标记为正样本（Rise Threshold 4%），导致正样本比例过高。
    *   **阈值过低**：`final_threshold` 默认为0.10，意味着模型只要有一点点置信度就预测为正，极度倾向于捕捉机会而非过滤风险。
    *   **策略兜底过于激进**：`is_predicted_low_point = True if (rsi_ok or strategy_ok) else False`，即只要 RSI 超卖或策略发出信号，就强制覆盖 AI 的低置信度，导致大量低质量信号被保留。

### 1.2 趋势识别的盲区
*   **现象**：在震荡（Sideways）和牛市（Bull）中命中率偏低，熊市反而最高。
*   **原因**：
    *   **特征工程不足**：可能缺乏有效的趋势过滤特征（如ADX、均线斜率组合），导致在无趋势或弱趋势中频繁触发超卖信号（RSI“钝化”现象）。
    *   **模型对环境不敏感**：模型可能未显式学习“当前市场状态”（Regime），导致一套参数应对所有行情。

### 1.3 训练与验证的割裂
*   **现象**：回测中模型训练效率显示“节省100%”，说明一直复用旧模型，未进行滚动更新。
*   **隐患**：市场风格切换（Concept Drift）时，旧模型可能失效。虽然全量回测显示尚可，但缺乏在线学习机制。

## 2. 改进方案

### 2.1 优化标签与阈值（提升 Precision）
*   **收紧正样本定义**：提高目标涨幅阈值（如从4%提至5%），或增加时间约束（如必须在10天内达到），减少“伪信号”。
*   **动态阈值调整**：不应固定在0.10。建议根据历史波动率或近期市场热度，动态调整 `final_threshold`（例如 VIX 高时降低阈值，低时提高）。

### 2.2 增强特征工程（解决趋势盲区）
*   **引入趋势强度指标**：加入 ADX（平均趋向指数）或 DMI，在趋势不明确时抑制信号。
*   **多周期共振**：结合周线级别的 RSI 或 MACD，避免日线级别的假突破。

### 2.3 改进决策逻辑（平衡 AI 与策略）
*   **双重确认机制**：修改“或”逻辑为“与”逻辑，或加权融合。例如：`if ai_confidence < 0.2 and strategy_signal: require strict_rsi < 25`。
*   **灰区策略优化**：在置信度灰区（0.05~0.15）内，强制要求更严格的辅助指标（如成交量显著放大）。

## 3. 具体执行计划

### 步骤 1: 深入诊断（已完成部分）
*   利用已有的回测数据，分析 False Positive（误报）集中在哪些特定形态（如阴跌中的小反弹）。

### 步骤 2: 代码调整（Action）
1.  **修改 `prediction_utils.py`**：调整决策逻辑，不再单纯由 RSI 或策略信号强制覆盖 AI 结果，而是引入更严格的条件。
2.  **调整 `system.yaml`**：尝试提高 `rise_threshold` 或 `final_threshold`，观察 Precision 变化。

### 步骤 3: 验证对比
*   在最近3个月（表现最差区间）重新运行回测，对比修改前后的 F1 分数和 Precision。

## 4. 总结
当前算法是一个“高灵敏度、低特异性”的系统，适合牛市初期“宁滥勿缺”的策略，但在震荡市容易反复止损。改进核心在于**提高信号门槛**和**引入趋势过滤**。