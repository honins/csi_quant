## 背景与入口

* 数据拉取入口：run.py 的 fetch 命令，调用增量更新到 CSV（中证500 1D）。[run.py](file:///d:/repo/csi_quant/run.py#L95-L104)、[run\_data\_fetch](file:///d:/repo/csi_quant/run.py#L413-L433)、[DataFetcher](file:///d:/repo/csi_quant/src/data/fetch_latest_data.py#L29-L47)

* 回测入口：run.py 的 backtest 命令，核心逻辑在滚动回测脚本。[run.py](file:///d:/repo/csi_quant/run.py#L83-L93)、[run\_rolling\_backtest](file:///d:/repo/csi_quant/examples/run_rolling_backtest.py#L37-L80)

* 数据读取与过滤：DataModule 按传入 start/end 截取数据区间。[get\_history\_data](file:///d:/repo/csi_quant/src/data/data_module.py#L40-L88)

## 执行步骤

1. 拉取最新数据

* 在 PowerShell 执行：

```powershell
python run.py fetch
```

* 作用：通过 akshare 获取 000905 指数最新 1D 数据并增量写入 data/SHSE.000905\_1d.csv。[fetch\_index\_data](file:///d:/repo/csi_quant/src/data/fetch_latest_data.py#L78-L147)、[save\_to\_csv](file:///d:/repo/csi_quant/src/data/fetch_latest_data.py#L149-L221)

1. 计算最近一个月区间

* end\_date：以数据文件最新交易日或“今天”为结束；

* start\_date：end\_date 往前 30 个自然日（脚本会据此筛选并以交易日滚动）。

* 若需固定区间，也可直接在命令行传入具体日期；不修改配置文件的 backtest 段。

1. 运行滚动回测（最近 1 个月）

* 在 PowerShell 执行（示例）：

```powershell
python run.py backtest 2025-12-11 2026-01-11
```

* 流程：加载配置→初始化 DataModule/StrategyModule/AIOptimizer→按交易日调用预测验证→聚合指标与输出。[config\_loader.load\_config](file:///d:/repo/csi_quant/src/utils/config_loader.py#L24-L73)、[predict\_and\_validate](file:///d:/repo/csi_quant/src/prediction/prediction_utils.py#L36-L83)

* 阈值说明：遵循项目规则，used 阈值维持 0.5，不做修改。

1. 查看输出结果

* 报告（Markdown）：results/reports/report\_rolling\_backtest\_\*.md，含 success\_rate/precision/recall/f1 等。[报告生成](file:///d:/repo/csi_quant/examples/run_rolling_backtest.py#L387-L417)

* 明细（CSV，可选）：results/csv/daily\_details\_rolling\_backtest\_\*.csv，含每日信号与指标。[CSV导出](file:///d:/repo/csi_quant/examples/run_rolling_backtest.py#L738-L827)

## 成功判定

* 命令均成功执行，无异常；

* 报告与（可选）明细文件在 results 目录生成；

* 报告中的区间覆盖最近约 30 天交易日并含有效统计指标。

## 注意事项

* Windows 环境下使用 PowerShell，不使用 &&；

* 不修改 system.yaml 中的 backtest 或 used 阈值；

* 若数据拉取失败，可直接运行独立脚本作为备选：[fetch\_latest\_data.py](file:///d:/repo/csi_quant/src/data/fetch_latest_data.py#L291-L320)。

## 参考代码位置

* 运行入口：[run.py](file:///d:/repo/csi_quant/run.py)

* 数据拉取核心：[fetch\_latest\_data.py](file:///d:/repo/csi_quant/src/data/fetch_latest_data.py)

* 回测脚本：[run\_rolling\_backtest.py](file:///d:/repo/csi_quant/examples/run_rolling_backtest.py)

* 数据模块：[data\_module.py](file:///d:/repo/csi_quant/src/data/data_module.py)

* 预测验证：[prediction\_utils.py](file:///d:/repo/csi_quant/src/prediction/prediction_utils.py)

