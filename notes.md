# 项目记录

## 项目概述

本项目是一个基于机器学习的量化交易系统，专注于中证500指数的预测和分析。

### 核心功能

1. **CSI 500 (000905)**
   - 数据获取和处理
   - 技术指标计算
   - 机器学习模型训练
   - 预测和回测

### 数据结构

- CSI 500数据: `data/SHSE.000905_1d.csv`

## 2025年7-8月回测记录 (2025-09-27 23:45:20)

### 回测执行状态
- ✅ **回测完成**: 2025-07-01 至 2025-08-31 (62天)
- ✅ **报告生成**: `results/reports/report_rolling_backtest_20250927_234520.md`
- ✅ **明细导出**: `results/csv/daily_details_rolling_backtest_20250927_234520.csv`

### 核心回测结果
- **预测成功率**: **9.09%** (4/44) ⚠️ **表现较差**
- **F1 Score**: **16.67%**
- **Precision**: 100.00% (预测为正的全部正确)
- **Recall**: 9.09% (漏掉了大量机会)
- **平均置信度**: 0.2712

### 市场环境分析
- **市场趋势**: 全部44天均为牛市环境
- **模型表现**: 在牛市中命中率仅9.09%，严重低估
- **置信度分布**: 84.09%的预测置信度低于0.4

### 高置信度预测分析
- **高置信度预测** (>0.5): 4个，**全部正确** (100%准确率)
  - 2025-08-01: 置信度87%, 涨幅13.37% ✅
  - 2025-07-31: 置信度84%, 涨幅13.13% ✅
  - 2025-08-04: 置信度79%, 涨幅13.55% ✅
  - 2025-08-08: 置信度58%, 涨幅12.44% ✅

### 关键发现
1. **高置信度可靠**: 置信度>0.5的预测准确率100%
2. **保守策略**: 模型过于保守，错过大量机会
3. **置信度相关性**: confidence vs future_max_rise = 0.683 (较强相关)
4. **阈值问题**: 当前0.5阈值可能过高，导致漏掉机会

### 策略参数
- 涨幅阈值: 4.0%
- 最大观察天数: 20天
- 置信度阈值: 0.50

### 生成文件
- 📄 **回测报告**: `results/reports/report_rolling_backtest_20250927_234520.md`
- 🧾 **每日明细**: `results/csv/daily_details_rolling_backtest_20250927_234520.csv`

### 优化建议
1. **降低置信度阈值**: 考虑将阈值从0.5降至0.3-0.4
2. **参数调优**: 针对牛市环境优化策略参数
3. **模型重训练**: 考虑使用更多牛市数据重新训练

## 最近一个月回测记录 (2025-09-27 23:38:22)

### 回测执行状态
- ✅ **回测完成**: 2025-08-28 至 2025-09-27 (30天)
- ✅ **报告生成**: `results/reports/report_rolling_backtest_20250927_233822.md`
- ✅ **明细导出**: `results/csv/daily_details_rolling_backtest_20250927_233822.csv`

### 核心回测结果
- **预测成功率**: 76.19% (16/21)
- **F1 Score**: 70.59%
- **Precision**: 66.67%
- **Recall**: 75.00%
- **平均置信度**: 0.4486

### 趋势识别能力
- **牛市趋势**: 19个样本，命中率 78.95%
- **震荡区间**: 1个样本，命中率 100.00%
- **置信度相关性**: confidence vs future_max_rise = 0.711

### 置信度质量分析
- **高置信度预测** (>0.6): 8个，正确率 75.00%
- **中等置信度** (0.4-0.6): 2个，正确率 100.00%
- **低置信度** (<0.4): 11个，正确率 72.73%

### 策略参数
- 涨幅阈值: 4.0%
- 最大观察天数: 20天
- 置信度阈值: 0.50

### 生成文件
- 📄 **回测报告**: `results/reports/report_rolling_backtest_20250927_233822.md`
- 🧾 **每日明细**: `results/csv/daily_details_rolling_backtest_20250927_233822.csv`

### 技术细节
- 使用已训练模型，无需重新训练
- 训练效率: 节省 100.0% (0/21)
- 数据源: 中证500指数 (SHSE.000905)

### 重要发现
1. **模型稳定性**: 76.19%的成功率表现良好
2. **置信度可靠性**: 0.711的相关性显示置信度与实际涨幅高度相关
3. **趋势适应性**: 在牛市环境下表现优异 (78.95%命中率)


### 移除中证1000相关数据和代码

**修改内容:**
1. **数据获取模块修改** (`src/data/fetch_latest_data.py`)
   - 移除000852相关代码和注释
   - 修改symbols列表，只保留000905
   - 更新文档注释

2. **数据文件清理**
   - 删除 `data/SHSE.000852_1d.csv`
   - 保留 `data/SHSE.000905_1d.csv`

3. **预测脚本修改** (`predict_recent_month.py`)
   - 将数据文件路径从000852改为000905

4. **文档更新** (`notes.md`)
   - 专注于中证500

**测试结果:**
- ✅ 数据获取功能正常，只获取中证500数据
- ✅ 预测功能正常，成功生成30天预测报告
- ✅ 系统现在专注于中证500指数分析

**影响范围:**
- 系统现在只处理中证500 (000905) 数据
- 所有功能模块已适配单一指数处理
- 配置和文档已同步更新


### 执行状态
- **执行时间**: 2025-09-27 23:13:45
- **执行状态**: 成功 ✅
- **数据源**: akshare
- **更新方式**: 增量更新

### 更新的指数数据
1. **CSI 500 (000905)**
   - 新增数据: 5条记录
   - 总数据量: 2612条
   - 最新日期: 2025-09-26
   - 最新收盘价: 5825.37

### 文件位置
- CSI 500数据: `data/SHSE.000905_1d.csv`

### 技术细节
- 数据源: akshare
- 更新方式: 增量更新
- 虚拟环境: 已激活 (G:\repo\csi_quant\venv)
- 数据格式: CSV
- 执行耗时: 3.90秒
- 执行命令: `python run.py fetch`

### 重要信息
- 系统支持增量更新，避免重复下载历史数据
- 数据已准备就绪，可用于策略分析和回测

## 滚动回测记录 (2025-09-27 23:15:01)

### 执行状态
- **执行时间**: 2025-09-27 23:15:01
- **执行状态**: 成功 ✅
- **回测期间**: 2025-08-28 至 2025-09-27 (最近一个月)
- **执行耗时**: 2.08秒

### 回测结果
- **总预测日期数**: 21天
- **正确预测数**: 16天
- **预测成功率**: 76.19%
- **Precision**: 66.67%
- **Recall**: 75.00%
- **F1 Score**: 70.59%
- **Specificity**: 76.92%
- **Balanced Accuracy**: 75.96%

### 策略参数
- **涨幅阈值**: 4.0%
- **最大观察天数**: 20天
- **置信度阈值**: 0.50
- **RSI超卖阈值**: 30
- **RSI偏低阈值**: 40

### 置信度分析
- **均值**: 0.4486
- **标准差**: 0.2364
- **最小值**: 0.2032
- **最大值**: 0.8940
- **相关性**: confidence vs future_max_rise = 0.711

### 趋势分布
- **多头趋势(bull)**: 19天，命中率78.95%
- **震荡趋势(sideways)**: 1天，命中率100.00%
- **未知趋势(unknown)**: 1天，命中率0.00%

### 生成文件
- **详细报告**: `results/reports/report_rolling_backtest_20250927_231501.md`
- **每日明细CSV**: `results/csv/daily_details_rolling_backtest_20250927_231501.csv`

### 技术细节
- **使用模型**: 已训练模型（禁止回测训练）
- **训练效率**: 0/21 (节省100.0%)
- **虚拟环境**: 已激活
- **执行命令**: `python run.py backtest 2025-08-28 2025-09-27`

### 重要发现
1. 模型在多头趋势中表现良好，命中率接近79%
2. 置信度与未来涨幅呈现较强正相关(0.711)
3. 高置信度信号(>0.8)表现优异，如9月4日(0.89置信度，9.60%涨幅)
4. 系统成功识别了震荡区间，并在该区间内实现100%命中率


## 小型实验记录 (2025-09-28 00:02:04)

### 环境
- **虚拟环境**: venv (Windows 激活 `venv\Scripts\activate`)
- **依赖安装**: `python -m pip install -r requirements.txt`

### 训练
- **命令**: `python run.py ai --quick`
- **耗时**: 8.3秒
- **要点**: 保持 `final_threshold=0.5`（不改动）；模型训练使用 `class_weight='balanced'`
- **结果**: 模型保存成功，策略参数优化完成

### 滚动回测
- **命令**: `python run.py r 2025-07-01 2025-08-31`
- **报告**: `results/reports/report_rolling_backtest_20250928_000204.md`
- **指标**: 成功率 54.55%，F1 0.706，Recall 0.545，Precision 1.000
- **说明**: 阈值=0.5 严格保持；报告包含置信度分布与概率校准评估

### 结论/后续
- 本次为小型实验，仅做流程验证与报告生成
- 保持市场尊重：不修改核心逻辑与阈值
- 后续若需要A/B测试，可使用回测脚本的 override_dynamic_threshold 选项（保持默认关闭）