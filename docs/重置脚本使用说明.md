# 策略参数重置脚本使用说明

本项目提供了两个参数重置脚本，用于将策略参数恢复到默认值。

## 脚本概述

### 1. `reset_strategy_params.py` - 完整重置脚本

功能强大的参数重置工具，支持选择性重置和详细的备份管理。

**特点：**
- 支持选择性重置（策略参数、置信度权重、优化参数等）
- 自动创建带时间戳的备份
- 安全确认机制
- 详细的操作日志
- 支持查看当前配置

### 2. `quick_reset.py` - 快速重置脚本

简化的重置工具，专注于快速重置核心参数。

**特点：**
- 一键重置核心参数
- 自动备份
- 操作简单快速
- 适合日常使用

## 使用方法

### 完整重置脚本使用

#### 基本语法
```bash
python reset_strategy_params.py [选项]
```

#### 可用选项

| 选项 | 说明 |
|------|------|
| `--all` | 重置所有参数 |
| `--strategy` | 仅重置策略参数 |
| `--confidence` | 仅重置置信度权重 |
| `--optimization` | 仅重置优化参数 |
| `--backup` | 仅创建备份，不重置 |
| `--force` | 跳过确认提示 |
| `--show strategy` | 显示当前策略配置 |
| `--show system` | 显示当前系统配置 |
| `--help` | 显示帮助信息 |

#### 使用示例

```bash
# 查看帮助
python reset_strategy_params.py --help

# 查看当前策略配置
python reset_strategy_params.py --show strategy

# 仅创建备份
python reset_strategy_params.py --backup

# 重置所有参数（推荐）
python reset_strategy_params.py --all

# 仅重置策略参数
python reset_strategy_params.py --strategy

# 仅重置置信度权重
python reset_strategy_params.py --confidence

# 仅重置优化参数
python reset_strategy_params.py --optimization

# 强制重置（跳过确认）
python reset_strategy_params.py --all --force
```

### 快速重置脚本使用

```bash
# 运行快速重置
python quick_reset.py
```

脚本会提示确认，输入 `y` 或 `yes` 或 `是` 确认重置。

## 重置内容说明

### 完整重置 (`--all`)

重置以下所有内容：
- **策略参数**：`rise_threshold`、`max_days` 等
- **置信度权重**：所有 `confidence_weights` 参数
- **优化算法参数**：遗传算法、贝叶斯优化等
- **系统配置**：数据源、日志等系统级参数
- **删除优化结果**：`optimized_params.yaml` 文件

### 策略参数重置 (`--strategy`)

重置核心策略参数：
```yaml
strategy:
  rise_threshold: 0.04      # 涨幅阈值
  max_days: 20             # 最大持有天数
  confidence_weights:      # 置信度权重
    rsi_oversold_threshold: 30
    rsi_low_threshold: 40
    final_threshold: 0.5
    # ... 其他权重参数
```

### 置信度权重重置 (`--confidence`)

重置所有置信度相关参数：
- RSI 相关权重
- 布林带权重
- 成交量权重
- 趋势权重
- 最终阈值等

### 优化参数重置 (`--optimization`)

重置优化算法配置：
- 贝叶斯优化参数
- 遗传算法参数
- 早停机制
- 高级优化选项

### 快速重置内容

快速重置脚本会重置：
- 策略核心参数
- 主要置信度权重
- 优化算法基础参数
- 删除 `optimized_params.yaml`

## 默认参数值

### 核心策略参数默认值

```yaml
strategy:
  rise_threshold: 0.04      # 4% 涨幅阈值
  max_days: 20             # 最大20天
  
confidence_weights:
  final_threshold: 0.5      # 最终阈值 50%
  rsi_oversold_threshold: 30.0  # RSI超卖阈值
  rsi_low_threshold: 40.0   # RSI低位阈值
  dynamic_confidence_adjustment: 0.1  # 动态调整
  market_sentiment_weight: 0.15  # 市场情绪权重
  trend_strength_weight: 0.15   # 趋势强度权重
```

### 优化算法默认值

```yaml
genetic_algorithm:
  population_size: 100      # 种群大小
  generations: 20          # 迭代代数
  crossover_rate: 0.8      # 交叉率
  mutation_rate: 0.1       # 变异率
  
bayesian_optimization:
  n_calls: 100            # 调用次数
  n_initial_points: 20    # 初始点数
  acq_func: "EI"          # 采集函数
```

## 备份机制

### 自动备份

两个脚本都会在重置前自动创建备份：

```
config/backups/
├── reset_backup_20250108_143022/     # 完整重置备份
│   ├── strategy_backup.yaml
│   ├── system_backup.yaml
│   └── optimized_params_backup.yaml
└── quick_reset_20250108_143156/      # 快速重置备份
    └── strategy_backup.yaml
```

### 手动备份

```bash
# 仅创建备份，不重置
python reset_strategy_params.py --backup
```

### 恢复备份

如需恢复，手动复制备份文件：

```bash
# 恢复策略配置
cp config/backups/reset_backup_20250108_143022/strategy_backup.yaml config/strategy.yaml

# 恢复系统配置
cp config/backups/reset_backup_20250108_143022/system_backup.yaml config/system.yaml
```

## 使用建议

### 何时使用重置脚本

1. **参数优化后效果不佳**：重置到稳定的默认值
2. **配置文件损坏**：恢复到可用状态
3. **测试新策略前**：确保干净的起始状态
4. **参数过度优化**：回到保守设置
5. **系统异常**：排除参数配置问题

### 推荐使用流程

1. **评估当前配置**
   ```bash
   python reset_strategy_params.py --show strategy
   ```

2. **创建备份**
   ```bash
   python reset_strategy_params.py --backup
   ```

3. **选择重置方式**
   - 问题严重：`python reset_strategy_params.py --all`
   - 快速修复：`python quick_reset.py`
   - 部分重置：`python reset_strategy_params.py --confidence`

4. **验证重置结果**
   ```bash
   python run.py --mode test
   ```

### 注意事项

⚠️ **重要提醒**：

1. **重置前备份**：脚本会自动备份，但建议手动确认
2. **测试验证**：重置后运行测试确认配置正确
3. **优化结果丢失**：重置会删除 `optimized_params.yaml`
4. **环境一致性**：确保在正确的项目目录下运行
5. **权限检查**：确保有配置文件的读写权限

## 故障排除

### 常见问题

**Q: 脚本提示文件不存在**
```
A: 确保在项目根目录下运行脚本，检查 config/ 目录是否存在
```

**Q: 重置后系统无法运行**
```
A: 检查配置文件格式，从备份恢复，或重新运行重置脚本
```

**Q: 备份文件在哪里**
```
A: 备份位于 config/backups/ 目录下，按时间戳命名
```

**Q: 如何恢复特定参数**
```
A: 从备份文件中复制需要的参数到当前配置文件
```

### 错误处理

如果重置过程中出现错误：

1. **查看错误信息**：脚本会显示具体错误
2. **检查文件权限**：确保可以读写配置文件
3. **从备份恢复**：使用自动创建的备份文件
4. **重新运行**：清理后重新执行重置

## 总结

- **日常使用**：推荐 `quick_reset.py`
- **精确控制**：使用 `reset_strategy_params.py` 的选项
- **完全重置**：使用 `--all` 选项
- **安全第一**：始终确认备份存在
- **测试验证**：重置后运行测试

这些脚本为策略参数管理提供了安全、便捷的重置方案，帮助维护系统的稳定性和可靠性。